<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="orders">
    <select id="list" resultType="Orders">
        SELECT * FROM orders
        WHERE cust_num = #{orders.custNum}
    </select>


    <resultMap id="orderDetailMap" type="Ordering" autoMapping="true">
        <id column="order_num" property="orderNum"/>

        <association property="orderDetail" column="order_num" autoMapping="true" javaType="OrderDetail">
            <id column="order_num" property="orderNum"/>
        </association>
    </resultMap>

    <resultMap id="MovieMap" type="Ordering" extends="orderDetailMap" autoMapping="true">
        <id property="movieNum" column="movie_num"/>

        <collection property="orders" column="movie_num" autoMapping="true" javaType="Orders">
            <id column="movie_num" property="movieNum"/>
        </collection>
    </resultMap>

    <select id="ordering" resultMap="orderDetailMap, MovieMap">
        SELECT O.*, OD.ORDER_DETAIL_NUM, OD.ORDER_NUM order_num, OD.ORDER_FOOD_NUM, OD.FOOD_NUM, OD.SUM_PRICE,OD.PICKUP_DATE,
        MOVIE.MOVIE_NUM movie_num, MOVIE.MOVIE_GENRE, MOVIE.MOVIE_NAME, MOVIE.MOVIE_DIRECTOR, MOVIE.MOVIE_OPENDATE, MOVIE.MOVIE_AGERANGE,
        MOVIE.MOVIE_COUNTRY, MOVIE.MOVIE_PRICE, MOVIE.MOVIE_INFO
        FROM ORDERS O LEFT JOIN order_detail OD ON(O.ORDER_NUM = OD.ORDER_NUM) JOIN MOVIE ON (OD.MOVIE_NUM = MOVIE.MOVIE_NUM)
        WHERE OD.MOVIE_NUM = #{movie.movieNum} AND O.CUST_NUM = #{orders.custNum}
    </select>

</mapper>